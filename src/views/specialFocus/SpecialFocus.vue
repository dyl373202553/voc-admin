<template>
    <div class="app-container">
        <el-card class="box-card">
            <div slot="header" class="clearfix">
                <span class="header-title">特别关注{{ $route.params.viewStatus }}_{{ $route.params.id }}</span>
            </div>
            <el-form ref="dataForm" :model="dataForm">
                <el-form-item label="开始时间">
                    <el-col :span="11">
                        <el-date-picker
                        v-model="dataForm.startTime"
                        type="datetime"
                        placeholder="请选择开始时间"
                        style="width: 100%;"
                        :disabled="$route.params.viewStatus === '3'"
                        />
                    </el-col>
                </el-form-item>
                <el-form-item label="结束时间">
                    <el-col :span="11">
                        <el-date-picker
                        v-model="dataForm.endTime"
                        type="datetime"
                        placeholder="请选择结束时间"
                        style="width: 100%;"
                        :disabled="$route.params.viewStatus === '3'"
                        />
                    </el-col>
                </el-form-item>
                <el-form-item label="内容上传">
                内容上传
                    <el-col :span="24" v-show="$route.params.id">
                        <img :src="dataForm.content"/>
                    </el-col>
                </el-form-item>
                <el-form-item v-show="$route.params.viewStatus !== '3'" class="dbtn text-center">
                    <el-button type="primary" round @click="onSubmit">发布</el-button>
                    <!-- <el-button v-show="$route.params.statusName" type="primary" round>编辑</el-button> -->
                    <el-button v-show="$route.params.viewStatus" type="danger" plain round @click="onOffLine($route.params.id)">结束</el-button>
                </el-form-item>
            </el-form>
        </el-card>
    </div>
</template>

<script lang="ts">
import { Component, Vue } from "vue-property-decorator"
import { postSpecialFocus, getSpecialFocusDetail, postOffLine } from "@/api/specialFocus/SpecialFocus"
import { MessageBox } from "element-ui"
import { day } from "@/lib/js/unitls"
@Component
export default class SpecialFocus extends Vue {
    private dialogFormVisible = false
    private dataForm = {
        startTime: "",
        endTime: "",
        content: "",
        status: "0", // 上线状态（0：上线，1：下线）
        id: ""
    }

    protected mounted() {
        if (this.$route.params.id) {
            this.load()
        }
    }

    private load() {
        const params = {
            id: this.$route.params.id
        }
        getSpecialFocusDetail(params).then((res) => {
            if (res) {
                this.dataForm = res.data
            }
        })
    }

    // 发布
    private onSubmit() {
        this.dataForm.startTime = day(this.dataForm.startTime, "YYYY-MM-DD HH:mm:ss")
        this.dataForm.endTime = day(this.dataForm.endTime, "YYYY-MM-DD HH:mm:ss")
        if (this.$route.params.id) {
            this.dataForm.id = this.$route.params.id
        }
        postSpecialFocus(this.dataForm).then((res) => {
            if (res) {
                MessageBox.alert(`操作成功`, "成功", { type: "success" })
            }
        })
    }

    // 结束-下线
    private onOffLine(id: string) {
        postOffLine(id).then((res) => {
            if (res) {
                MessageBox.alert(`操作成功`, "成功", { type: "success" })
                // this.load()
            }
        })
    }
}
</script>

<style scoped>
.line{
  text-align: center;
}
</style>
